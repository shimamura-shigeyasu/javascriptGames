<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Making your first Phaser 3 Game 0</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style type="text/css">
      body {
        margin: 0;
      }
    </style>
  </head>
  <body>
    <script type="text/javascript">
      var config = {
        type: Phaser.WEBGL,
        width: 640,
        height: 480,
        backgroundColor: "#bfcc00",
        parent: "phaser-example",
        scene: {
          preload: preload,
          create: create,
          update: update,
        },
      };

      var snake;
      var cursors;

      //  Direction consts
      var UP = 0;
      var DOWN = 1;
      var LEFT = 2;
      var RIGHT = 3;

      var game = new Phaser.Game(config);

      function preload() {
        this.load.image("food", "assets/food.png");
        this.load.image("body", "assets/body.png");
      }

      function create() {
        var Snake = new Phaser.Class({
          initialize: function Snake(scene, x, y) {
            this.headPosition = new Phaser.Geom.Point(x, y);

            this.body = scene.add.group();

            this.head = this.body.create(x * 16, y * 16, "body");
            this.head.setOrigin(0);

            this.alive = true;

            this.speed = 100;

            this.moveTime = 0;

            this.heading = RIGHT;
            this.direction = RIGHT;
          },

          update: function (time) {
            if (time >= this.moveTime) {
              return this.move(time);
            }
          },

          faceLeft: function () {
            if (this.direction === UP || this.direction === DOWN) {
              this.heading = LEFT;
            }
          },

          faceRight: function () {
            if (this.direction === UP || this.direction === DOWN) {
              this.heading = RIGHT;
            }
          },

          faceUp: function () {
            if (this.direction === LEFT || this.direction === RIGHT) {
              this.heading = UP;
            }
          },

          faceDown: function () {
            if (this.direction === LEFT || this.direction === RIGHT) {
              this.heading = DOWN;
            }
          },

          move: function (time) {
            switch (this.heading) {
              case LEFT:
                this.headPosition.x = Phaser.Math.Wrap(
                  this.headPosition.x - 1,
                  0,
                  40
                );
                break;

              case RIGHT:
                this.headPosition.x = Phaser.Math.Wrap(
                  this.headPosition.x + 1,
                  0,
                  40
                );
                break;

              case UP:
                this.headPosition.y = Phaser.Math.Wrap(
                  this.headPosition.y - 1,
                  0,
                  30
                );
                break;

              case DOWN:
                this.headPosition.y = Phaser.Math.Wrap(
                  this.headPosition.y + 1,
                  0,
                  30
                );
                break;
            }

            this.direction = this.heading;

            Phaser.Actions.ShiftPosition(
              this.body.getChildren(),
              this.headPosition.x * 16,
              this.headPosition.y * 16,
              1
            );

            this.moveTime = time + this.speed;

            return true;
          },
        });

        snake = new Snake(this, 8, 8);

        cursors = this.input.keyboard.createCursorKeys();
      }

      function update(time, delta) {
        if (!snake.alive) {
          return;
        }

        if (cursors.left.isDown) {
          snake.faceLeft();
        } else if (cursors.right.isDown) {
          snake.faceRight();
        } else if (cursors.up.isDown) {
          snake.faceUp();
        } else if (cursors.down.isDown) {
          snake.faceDown();
        }

        snake.update(time);
      }
    </script>
  </body>
</html>
